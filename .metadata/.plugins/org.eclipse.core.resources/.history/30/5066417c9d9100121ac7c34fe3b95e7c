import java.util.ArrayList;

import javax.media.opengl.GL2;
import javax.vecmath.Color4b;
import javax.vecmath.Matrix4f;

import figures.Prism;


public class SkeletonPart extends GraphicsObject implements DimensionListener {
	private String name;
	private float length;
	private Prism bone;
	private SkeletonPart root = null;
	private SkeletonPartPosition position;
	private MotionDimension<Integer> rotY;
	private MotionDimension<Integer> rotZ;
	private MotionDimension<Integer> rotX;
	private MotionDimension<Float> stretchX;
	private ArrayList<SkeletonPart> childParts;
	
	public SkeletonPart(String name, float length, SkeletonPartPosition position) {
		super();
		this.setName(name);
		this.setLength(length);
		setInitRotY(0);
		setRotY(null);
		setInitRotZ(0);
		setRotZ(null);
		setInitRotX(0);
		setRotX(null);
		setStretchX(null);
		this.bone = new Prism(5, length, 0.2f);
		this.childParts = new ArrayList<SkeletonPart>();
	}
	
	public SkeletonPart(String name, float length) {
		this(name, length, new SkeletonPartPosition());
	}
	
	public SkeletonPart(String name) {
		this(name, 0);
	}
	
	public void draw(GL2 gl) {
		draw(gl, false);
	}
	
	public void draw(GL2 gl, boolean withMyColorID) {
		if(withMyColorID) {
			// object will draw with color 
			gl.glColor4b(myColorID.getX(), myColorID.getY(), myColorID.getZ(), myColorID.getW());
		} else {
			// set other graphics parameters
		}
		
		// set into position relative to root part
		if(getRoot() != null) {
			gl.glTranslatef(getRoot().getLength()*getPosition().getRelativeX(), getPosition().getY(), getPosition().getZ());
		}
		if(getPosition().getInitRotY() != 0) gl.glRotatef(getPosition().getY(), 0, 1, 0);
		if(getPosition().getInitRotZ() != 0) gl.glRotatef(getPosition().getZ(), 0, 0, 1);
		
		
		if (rotY != null) gl.glRotatef(rotY.getNumericValue(), 0, 1, 0);
		if (rotZ != null) gl.glRotatef(rotZ.getNumericValue(), 0, 0, 1);
		if (rotZ != null) gl.glRotatef(rotZ.getNumericValue(), 1, 0, 0);
		
		bone.draw(gl);
		
		for(SkeletonPart childPart : childParts) {
			gl.glPushMatrix();
			childPart.draw(gl, withMyColorID);
			gl.glPopMatrix();
		}
	}
	
	public ArrayList<RotateDimension> getRotateDimensions() { return this.rotateDimensions; }

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}
	
	public void addChildPart(SkeletonPart childPart) {
		childParts.add(childPart);
		childPart.setRoot(this);
	}

	public float getLength() {
		return length*getStretchX().getNumericValue();
	}

	public void setLength(float length) {
		this.length = length;
	}

	public SkeletonPart getRoot() {
		return root;
	}

	public void setRoot(SkeletonPart root) {
		this.root = root;
	}
	
	public SkeletonPart getWithColor(Color4b pixelColor) {
		if(this.myColorID.equals(pixelColor)) {
			return this;
		}
		SkeletonPart selectedPart;
		for(SkeletonPart childPart: childParts) {
			if((selectedPart = childPart.getWithColor(pixelColor)) != null) {
				return selectedPart;
			}
		}
		return null;
	}


	public SkeletonPartPosition getPosition() { return position; }

	public void setPosition(SkeletonPartPosition position) { this.position = position;	}

	public MotionDimension<Integer> getRotY() { return rotY; }

	public void setRotY(MotionDimension<Integer> rotY) { this.rotY = rotY; }

	public MotionDimension<Integer> getRotZ() { return rotZ; }

	public void setRotZ(MotionDimension<Integer> rotZ) { this.rotZ = rotZ; }

	public MotionDimension<Float> getStretchX() { return stretchX; }

	public void setStretchX(MotionDimension stretchX) {
		this.stretchX = stretchX;
	}

	public int getInitRotY() {
		return initRotY;
	}

	public void setInitRotY(int initRotY) {
		this.initRotY = initRotY;
	}

	public int getInitRotZ() {
		return initRotZ;
	}

	public void setInitRotZ(int initRotZ) {
		this.initRotZ = initRotZ;
	}

	public MotionDimension<Integer> getRotX() {
		return rotX;
	}

	public void setRotX(MotionDimension<Integer> rotX) {
		this.rotX = rotX;
	}

	public int getInitRotX() {
		return initRotX;
	}

	public void setInitRotX(int initRotX) {
		this.initRotX = initRotX;
	}
}
